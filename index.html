<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Conway's Game of Life</title>
<link rel="icon" type="image/png" href="/favicon.png">
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%; width: 100%;
    overflow: hidden;
    background: #fff;
    font-family: system-ui, sans-serif;
    color: #111;
  }
  #game {
    display: block;
    width: 100vw;
    height: 100vh;
    background: #fff;
    cursor: crosshair;
  }

  /* Bottom control panel */
  #controls {
    position: fixed;
    bottom: -140px;
    left: 0;
    width: 100%;
    background: rgba(0,0,0,0.85);
    color: #eee;
    text-align: center;
    padding: 12px 0 28px 0;
    transition: bottom 0.3s ease-in-out;
  }
  #controls:hover { bottom: 0; }

  #hoverzone {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 20px;
    background: transparent;
  }

  #hoverzone:hover + #controls,
  #controls:hover {
    bottom: 0;
  }

  button, select, input[type=range] {
    margin: 4px;
    background: #222;
    color: #eee;
    border: 1px solid #444;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 13px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  button svg {
    width: 14px;
    height: 14px;
    fill: currentColor;
  }

  button:hover, select:hover, input[type=range]:hover { background: #333; }
  label { margin-left: 10px; }

  /* GitHub watermark link */
  #watermark {
    position: absolute;
    right: 10px;
    bottom: 6px;
    font-size: 12px;
    color: #aaa;
  }
  #watermark a {
    color: #aaa;
    text-decoration: none;
  }
  #watermark a:hover {
    color: #fff;
    text-decoration: underline;
  }

  /* Custom popup overlay */
  #popupOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
  }
  #popupBox {
    background: #fff;
    color: #111;
    padding: 20px 30px;
    border-radius: 6px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    max-width: 320px;
    text-align: center;
  }
  #popupButtons {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 12px;
  }
  #popupButtons button {
    padding: 6px 16px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-weight: 600;
  }
  #popupConfirm { background: #d33; color: #fff; }
  #popupCancel { background: #444; color: #eee; }
  #popupConfirm:hover { background: #b00; }
  #popupCancel:hover { background: #333; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hoverzone"></div>

<!-- Control panel -->
<div id="controls">
  <button id="startStop">
    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> Start
  </button>
  <button id="step">
    <svg viewBox="0 0 24 24"><path d="M7 6v12l8.5-6L7 6zM18 6h2v12h-2z"/></svg> Step
  </button>
  <button id="clear">
    <svg viewBox="0 0 24 24"><path d="M3 6l3 18h12l3-18H3zm16.5-3l-.5 2H5L4.5 3h15z"/></svg> Clear
  </button>
  <button id="random">
    <svg viewBox="0 0 24 24"><path d="M4 4h2v2H4V4zm3 3h2v2H7V7zm3 3h2v2h-2v-2zm3 3h2v2h-2v-2zm3 3h2v2h-2v-2z"/></svg> Random
  </button>
  <label>Speed:
    <input type="range" id="speed" min="50" max="1000" value="200">
  </label>
  <select id="presets">
    <option value="">-- Presets --</option>
    <option value="glider">Glider</option>
    <option value="pulsar">Pulsar</option>
    <option value="gosper">Gosper Glider Gun</option>
    <option value="lwss">Lightweight Spaceship</option>
  </select>
  <button id="resetView">
    <svg viewBox="0 0 24 24"><path d="M12 5V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6a6 6 0 0 1-5.65-4H4.26A8.002 8.002 0 0 0 12 20a8 8 0 0 0 0-16z"/></svg> Reset View
  </button>
  <div id="watermark">
    <a href="https://github.com/Spoutcodes/Conways-Game-Of-Life" target="_blank">View source on GitHub</a>
  </div>
</div>

<!-- Custom confirmation popup -->
<div id="popupOverlay">
  <div id="popupBox">
    <div id="popupMessage">Do you want to discard this current simulation?</div>
    <div id="popupButtons">
      <button id="popupConfirm">Discard</button>
      <button id="popupCancel">Cancel</button>
    </div>
  </div>
</div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;drawGrid();}
window.addEventListener("resize",resizeCanvas);
let cellSize=10,offsetX=window.innerWidth/2,offsetY=window.innerHeight/2,zoom=1;
let grid=new Map(),running=false,timer=null,speed=document.getElementById("speed").value;
const undoStack=[],redoStack=[],MAX_HISTORY=50;
function saveState(){if(running)return;undoStack.push(new Map(grid));if(undoStack.length>MAX_HISTORY)undoStack.shift();redoStack.length=0;}
function key(x,y){return`${x},${y}`;}
function setCell(x,y,v){if(v)grid.set(key(x,y),1);else grid.delete(key(x,y));}
function getCell(x,y){return grid.has(key(x,y));}
function drawGrid(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.save();ctx.translate(offsetX,offsetY);ctx.scale(zoom,zoom);
 ctx.fillStyle="#000";
 for(const k of grid.keys()){const[x,y]=k.split(",").map(Number);ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);}
 const viewCols=Math.ceil(canvas.width/(cellSize*zoom)),viewRows=Math.ceil(canvas.height/(cellSize*zoom));
 const left=-offsetX/zoom/cellSize,top=-offsetY/zoom/cellSize;
 ctx.strokeStyle="#ddd";ctx.lineWidth=1/zoom;
 for(let x=Math.floor(left);x<left+viewCols;x++){ctx.beginPath();ctx.moveTo(x*cellSize,top*cellSize);ctx.lineTo(x*cellSize,(top+viewRows)*cellSize);ctx.stroke();}
 for(let y=Math.floor(top);y<top+viewRows;y++){ctx.beginPath();ctx.moveTo(left*cellSize,y*cellSize);ctx.lineTo((left+viewCols)*cellSize,y*cellSize);ctx.stroke();}
 ctx.restore();
}
function countNeighbors(x,y){let sum=0;for(let dy=-1;dy<=1;dy++)for(let dx=-1;dx<=1;dx++)if((dx||dy)&&getCell(x+dx,y+dy))sum++;return sum;}
function nextGen(){saveState();const newGrid=new Map(),checked=new Set();
 for(const k of grid.keys()){const[x,y]=k.split(",").map(Number);
  for(let dy=-1;dy<=1;dy++)for(let dx=-1;dx<=1;dx++){
    const nx=x+dx,ny=y+dy,nk=key(nx,ny);
    if(checked.has(nk))continue;checked.add(nk);
    const n=countNeighbors(nx,ny);
    if(getCell(nx,ny)){if(n===2||n===3)newGrid.set(nk,1);}else if(n===3)newGrid.set(nk,1);
  }}
 grid=newGrid;drawGrid();
}
function startStop(){running=!running;const btn=document.getElementById("startStop");
 btn.innerHTML=running?'<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg> Stop':'<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> Start';
 if(running)run();else clearTimeout(timer);}
function run(){nextGen();if(running)timer=setTimeout(run,speed);}
function clearGrid(){saveState();grid.clear();drawGrid();}
function randomFill(){saveState();for(let y=-20;y<20;y++)for(let x=-20;x<20;x++)if(Math.random()<0.2)setCell(x,y,1);drawGrid();}
function worldToCell(cx,cy){const x=(cx-offsetX)/(cellSize*zoom),y=(cy-offsetY)/(cellSize*zoom);return[Math.floor(x),Math.floor(y)];}

// Drawing / panning
let drawing=false,drawMode=null,dragging=false,lastX,lastY;
canvas.addEventListener("mousedown",e=>{
 if(e.button===2){dragging=true;lastX=e.clientX;lastY=e.clientY;}
 else if(e.button===0){const[x,y]=worldToCell(e.clientX,e.clientY);saveState();drawMode=getCell(x,y)?"erase":"add";drawing=true;setCell(x,y,drawMode==="add");drawGrid();}
});
canvas.addEventListener("mouseup",e=>{if(e.button===2)dragging=false;if(e.button===0){drawing=false;drawMode=null;}});
canvas.addEventListener("contextmenu",e=>e.preventDefault());
canvas.addEventListener("mousemove",e=>{
 if(dragging){offsetX+=e.clientX-lastX;offsetY+=e.clientY-lastY;lastX=e.clientX;lastY=e.clientY;drawGrid();}
 else if(drawing&&drawMode){const[x,y]=worldToCell(e.clientX,e.clientY);setCell(x,y,drawMode==="add");drawGrid();}
});
canvas.addEventListener("wheel",e=>{
 e.preventDefault();const zoomFactor=1.1,mx=e.offsetX,my=e.offsetY,bx=(mx-offsetX)/(zoom*cellSize),by=(my-offsetY)/(zoom*cellSize);
 zoom*=e.deltaY<0?zoomFactor:1/zoomFactor;zoom=Math.max(0.2,Math.min(zoom,10));
 const ax=(mx-offsetX)/(zoom*cellSize),ay=(my-offsetY)/(zoom*cellSize);
 offsetX+=(ax-bx)*cellSize*zoom;offsetY+=(ay-by)*cellSize*zoom;drawGrid();
});

document.getElementById("startStop").onclick=startStop;
document.getElementById("step").onclick=nextGen;
document.getElementById("clear").onclick=clearGrid;
document.getElementById("random").onclick=randomFill;
document.getElementById("speed").oninput=e=>speed=e.target.value;
document.getElementById("resetView").onclick=()=>{offsetX=window.innerWidth/2;offsetY=window.innerHeight/2;zoom=1;drawGrid();};

// Custom popup
const popupOverlay=document.getElementById("popupOverlay"),popupConfirm=document.getElementById("popupConfirm"),popupCancel=document.getElementById("popupCancel");
let pendingPreset=null;
function showPopup(preset){pendingPreset=preset;popupOverlay.style.display="flex";}
popupCancel.onclick=()=>{popupOverlay.style.display="none";pendingPreset=null;};
popupConfirm.onclick=()=>{popupOverlay.style.display="none";if(pendingPreset)loadPreset(pendingPreset);pendingPreset=null;};

document.getElementById("presets").onchange=function(){
 const val=this.value;if(!val)return;
 if(grid.size>0){showPopup(val);} else {loadPreset(val);}
};

function loadPreset(val){
 saveState();grid.clear();
 const add=c=>c.forEach(([x,y])=>setCell(x,y,1));
 if(val==="glider")add([[1,0],[2,1],[0,2],[1,2],[2,2]]);
 else if(val==="pulsar"){const p=[[2,0],[3,0],[4,0],[8,0],[9,0],[10,0],[0,2],[5,2],[7,2],[12,2],[0,3],[5,3],[7,3],[12,3],[0,4],[5,4],[7,4],[12,4],[2,5],[3,5],[4,5],[8,5],[9,5],[10,5],[2,7],[3,7],[4,7],[8,7],[9,7],[10,7],[0,8],[5,8],[7,8],[12,8],[0,9],[5,9],[7,9],[12,9],[0,10],[5,10],[7,10],[12,10],[2,12],[3,12],[4,12],[8,12],[9,12],[10,12]];add(p);}
 else if(val==="gosper"){const g=[[1,5],[1,6],[2,5],[2,6],[11,5],[11,6],[11,7],[12,4],[12,8],[13,3],[13,9],[14,3],[14,9],[15,6],[16,4],[16,8],[17,5],[17,6],[17,7],[18,6],[21,3],[21,4],[21,5],[22,3],[22,4],[22,5],[23,2],[23,6],[25,1],[25,2],[25,6],[25,7],[35,3],[35,4],[36,3],[36,4]];add(g);}
 else if(val==="lwss"){add([[1,0],[4,0],[0,1],[0,2],[4,2],[0,3],[1,3],[2,3],[3,3]]);}
 offsetX=window.innerWidth/2;offsetY=window.innerHeight/2;drawGrid();
}

window.addEventListener("keydown",e=>{
 if((e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="z"){e.preventDefault();if(undoStack.length){redoStack.push(new Map(grid));grid=undoStack.pop();drawGrid();}}
 else if((e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="y"){e.preventDefault();if(redoStack.length){undoStack.push(new Map(grid));grid=redoStack.pop();drawGrid();}}
});

resizeCanvas();
drawGrid();
</script>
</body>
</html>

